
(function(window, jRespond) {
  // Define breakpoints matching those in SASS.
  // @TODO: Have these generated by SASS.
  var dgBreakPoints = function(point) {
    var gen_column_width = 4;
    var gen_gutter_width = 1;
    var base_font_size = 16;

    var break_points = {
      bp_small: (((gen_column_width + gen_gutter_width) * 8) + 4) * base_font_size,
      bp_medium: (((gen_column_width + gen_gutter_width) * 12) + 6) * base_font_size,
      bp_large: (((gen_column_width + gen_gutter_width) * 16) + 8) * base_font_size
    };

    if (point && point in break_points) {
      return break_points[point];
    }

    return break_points;
  };

  // Call jRespond and add breakpoints.
  var mediaQueries = jRespond([
    {
      label: 'handheld',
      enter: 0,
      exit: dgBreakPoints('bp_small')
    },{
      label: 'tablet',
      enter: dgBreakPoints('bp_small'),
      exit: dgBreakPoints('bp_medium')
    },{
      label: 'laptop',
      enter: dgBreakPoints('bp_medium'),
      exit: dgBreakPoints('bp_large')
    },{
      label: 'desktop',
      enter: dgBreakPoints('bp_large'),
      exit: 99999
    }
  ]);

  // Hide the search.
  var searchDisable = function() {
    // Make sure the header-drop-down-thingy is hidden.
    var drop_down_thingy = window.document.getElementById('header-drop-down-thingy');
    drop_down_thingy.classList.remove('is-visible');

    // Disable activation of the header-drop-down-thingy.
    var search_link = window.document.getElementById('toggle-search');
    search_link.removeEventListener('click', toggleDropDownThingyVisibility)
  };

  // Show the search.
  var searchEnable = function() {
    // Remove display none from the html style attribute.
    var drop_down_thingy = window.document.getElementById('header-drop-down-thingy');
    drop_down_thingy.removeAttribute('style');

    // Instead of going to the search page display the header-drop-down-thingy.
    var search_link = window.document.getElementById('toggle-search');
    search_link.addEventListener('click', toggleDropDownThingyVisibility, true);
  };

  // Deal with clicks on the search button.
  var toggleDropDownThingyVisibility = function(e) {
    e.preventDefault();

    var drop_down_thingy = window.document.getElementById('header-drop-down-thingy');
    drop_down_thingy.classList.toggle('is-visible');
  };

  // Register enter and exit functions for laptop and desktop screens.
  mediaQueries.addFunc({
    breakpoint: ['laptop', 'desktop'],
    enter: function() {
      // Only enable search for large screens.
      searchEnable();
    },
    exit: function() {
      // Make sure search is disabled on small screens.
      searchDisable();
    }
  });

})(window, jRespond);
